<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title type="text">Recent Blog Posts</title>
  <id>http://blog.dbrgn.ch/feed.atom</id>
  <updated>2013-05-25T00:00:00Z</updated>
  <link href="http://blog.dbrgn.ch/" />
  <link href="http://blog.dbrgn.ch/feed.atom" rel="self" />
  <subtitle type="text">Recent blog posts</subtitle>
  <generator>Werkzeug</generator>
  <entry xml:base="http://blog.dbrgn.ch/feed.atom">
    <title type="text">Integrate Dokuwiki with SMF</title>
    <id>http://blog.dbrgn.ch/2009/9/1/integrate-dokuwiki-with-smf</id>
    <updated>2009-09-01T00:00:00Z</updated>
    <link href="http://blog.dbrgn.ch/2009/9/1/integrate-dokuwiki-with-smf" />
    <author>
      <name>Danilo Bargen</name>
    </author>
    <content type="html">&lt;p&gt;I recently needed an integration of Dokuwiki with SMF (Simple Machines Forum). After some research i
managed to get it done. Inspired by &lt;a class="reference external" href="http://forum.dokuwiki.org/thread/2161;nocount#postlistbottom"&gt;this thread&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I tested this with SMF 2.0 RC1.2 and DokuWiki 2009-02-14b.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Download and install both SMF and Dokuwiki. I separated them using a &lt;cite&gt;/forum&lt;/cite&gt; and a &lt;cite&gt;/wiki&lt;/cite&gt;
directory.&lt;/li&gt;
&lt;li&gt;Get the file &lt;cite&gt;smfauth.class.php&lt;/cite&gt; (version 0.3) from &lt;a class="reference external" href="http://blog.ticktag.org/addons/smfauth.class.zip"&gt;here&lt;/a&gt; and put it inside your &lt;cite&gt;wiki/inc/auth/&lt;/cite&gt;
directory&lt;/li&gt;
&lt;li&gt;Do the following changes in your &lt;cite&gt;smfauth.class.php&lt;/cite&gt; file:&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;find all instances of memberName and change to member_name
find all instances of realName and change to real_name
find all instances of emailAddress and change to email_address
find all instances of groupName and change to group_name
find all instances of additionalGroups and change to additional_groups
find all instances of dateRegistered and change to date_registered
find all instances of posterEmail and change to poster_email
find all instances of ID_GROUP and change to id_group
find all instances of ID_MEMBER and change to id_member
&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Edit the line in your &lt;cite&gt;smfauth.class.php&lt;/cite&gt; file where it says &lt;tt class="docutils literal"&gt;MODIFICATION REQUIRED&lt;/tt&gt; (line 32),
and include the absolute path to your &lt;cite&gt;forum/Settings.php&lt;/cite&gt; file&lt;/li&gt;
&lt;li&gt;Edit the file &lt;cite&gt;wiki/conf/local.php&lt;/cite&gt; and change the setting for &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;$conf['authtype']&lt;/span&gt;&lt;/tt&gt; to &lt;cite&gt;smfauth&lt;/cite&gt;&lt;/li&gt;
&lt;li&gt;Edit line 78 in &lt;cite&gt;smfauth.class.php&lt;/cite&gt; and do the following change:&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;change
AND (concat(&amp;#39;,&amp;#39;,u.additionalGroups,&amp;#39;,&amp;#39;) LIKE concat(&amp;#39;%,&amp;#39;,g.id_group,&amp;#39;,%&amp;#39;) OR u.id_group = g.id_group)&amp;quot;;
to
AND (concat(&amp;#39;,&amp;#39;,u.additional_groups,&amp;#39;,&amp;#39;) LIKE concat(&amp;#39;%,&amp;#39;,g.id_group,&amp;#39;,%&amp;#39;) OR u.id_group = g.id_group OR u.id_post_group = g.id_group)&amp;quot;;
&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Edit the file &lt;cite&gt;wiki/conf/local.php&lt;/cite&gt; and change the setting for &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;$conf['superuser']&lt;/span&gt;&lt;/tt&gt; to the name of the
superuser group in SMF (&amp;#64;Administrator in German, i'd guess it'd be &amp;#64;Admin in the English version)&lt;/li&gt;
&lt;li&gt;Add the following line to your wiki/conf/local.php file:&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;$conf[&amp;#39;auth&amp;#39;][&amp;#39;mysql&amp;#39;][&amp;#39;charset&amp;#39;] = &amp;#39;utf8&amp;#39;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;You should now be able to log in using your SMF superuser. Now add correct permissions for the
group 'Newbie' (case sensitive) in your Dokuwiki access control&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I think that's it, i hope i didn't forget anything. If you have any
questions, feel free to comment.&lt;/p&gt;
</content>
  </entry>
  <entry xml:base="http://blog.dbrgn.ch/feed.atom">
    <title type="text">PHP-FPM and Nginx Upstream Configuration</title>
    <id>http://blog.dbrgn.ch/2013/5/25/php-fpm-connection-refused</id>
    <updated>2013-05-25T00:00:00Z</updated>
    <link href="http://blog.dbrgn.ch/2013/5/25/php-fpm-connection-refused" />
    <author>
      <name>Danilo Bargen</name>
    </author>
    <content type="html">&lt;p&gt;Most &lt;a class="reference external" href="http://nginx.org/"&gt;nginx&lt;/a&gt; / &lt;a class="reference external" href="http://php-fpm.org/"&gt;php-fpm&lt;/a&gt; tutorials you'll find nowadays recommend to create an
nginx upstream configuration that listens on localhost port 9000.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
upstream php {
    server 127.0.0.1:9000;
}
&lt;/pre&gt;
&lt;p&gt;If you're using a current version of Debian and php5-fpm from &lt;a class="reference external" href="http://www.dotdeb.org/"&gt;dotdeb&lt;/a&gt;, this
won't work though and you'll see the following error message in your nginx log:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2013/05/25 00:12:04 [error] 17672#0: *76 connect() failed (111: Connection refused) while connecting to
upstream, client: 2a02:1205:5050:8530:c5f6:250c:ffa0:4d49, server: example.com, request: &amp;quot;GET /index.php
HTTP/1.1&amp;quot;, upstream: &amp;quot;fastcgi://127.0.0.1:9000&amp;quot;, host: &amp;quot;example.com&amp;quot;
&lt;/pre&gt;
&lt;p&gt;This is because the dotdeb version seems to have changed the default
configuration from the IP based version to a unix domain socket. You can grep
for the important line in your configuration:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
danilo&amp;#64;server:~$ grep -ri &amp;quot;listen = &amp;quot; /etc/php5/fpm/
/etc/php5/fpm/pool.d/www.conf:listen = /var/run/php5-fpm.sock
&lt;/pre&gt;
&lt;p&gt;To be on the safe side, you can also test whether any process is listening on
port 9000:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
danilo&amp;#64;server:~$ sudo lsof -i tcp:9000
danilo&amp;#64;server:~$
&lt;/pre&gt;
&lt;p&gt;It's trivial to adjust the nginx configuration accordingly:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
upstream php {
    server unix:/var/run/php5-fpm.sock;
}
&lt;/pre&gt;
&lt;p&gt;Simply restart nginx and everything should be working.&lt;/p&gt;
</content>
  </entry>
  <entry xml:base="http://blog.dbrgn.ch/feed.atom">
    <title type="text">XML Deklaration in PHP Datei</title>
    <id>http://blog.dbrgn.ch/2009/1/27/xml-deklaration-in-php-datei</id>
    <updated>2009-01-27T00:00:00Z</updated>
    <link href="http://blog.dbrgn.ch/2009/1/27/xml-deklaration-in-php-datei" />
    <author>
      <name>Danilo Bargen</name>
    </author>
    <content type="html">&lt;p&gt;Wer schonmal eine XML-Deklaration in einer PHP-Datei &lt;em&gt;ausserhalb&lt;/em&gt; der PHP Tags (&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;&amp;lt;?php&lt;/span&gt; &lt;span class="pre"&gt;?&amp;gt;&lt;/span&gt;&lt;/tt&gt;)
gemacht hat, weiss, dass es damit Probleme geben kann. Wenn nämlich die PHP Short Tags (&lt;tt class="docutils literal"&gt;&amp;lt;? &lt;span class="pre"&gt;?&amp;gt;&lt;/span&gt;&lt;/tt&gt;)
auf dem Server aktiviert sind, dann interpretiert der Parser die ersten zwei Zeichen der
XML-Deklaration als Parse-Startpunkt. Und gibt einen Syntax Error aus.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;utf-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Um dies zu verhindern, muss man lediglich die Zeichenfolge &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;&amp;lt;??&amp;gt;&lt;/span&gt;&lt;/tt&gt; zwischen öffnende Klammer und
Fragezeichen einfügen, und schon wird es vom Parser korrekt behandelt.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;&amp;lt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;??&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;utf-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content>
  </entry>
</feed>

