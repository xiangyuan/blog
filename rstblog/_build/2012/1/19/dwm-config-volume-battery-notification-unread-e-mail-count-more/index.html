<!doctype html>
<html lang="en">
    <head>
        <title>dwm config - volume, battery notification, unread e-mail count &amp; more</title>

        <!-- meta -->
        <meta name="author" content="Danilo Bargen">
        <meta name="dc.language" content="en-US">
        <meta name="dc.license" content="http://creativecommons.org/licenses/by-sa/3.0/">
        <meta name="description" content="My dwm configuration.">
        <meta name="keywords" content="dwm, sysadmin">
        
            <meta name="dc.date.created" content="2012-01-19">
            <meta name="dc.date.issued" content="2012-01-19">
        
        <meta name="google-site-verification" content="uJWWR6d5ESb8torD0v97T_07HLMGX7VzQ-smcUTc_IQ" />

        <!-- favicon -->
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <!-- newsfeed -->
        <link href="/feed.atom" rel="alternate" title="Feed" type="application/atom+xml">

        <!-- assets -->
        <link href="https://fonts.googleapis.com/css?family=Linden+Hill:400,400italic" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="/static/style.css?1371592067" type="text/css">
            <link rel="stylesheet" href="/static/_pygments.css?1371592069" type="text/css">
    </head>
    <body>
        <div id="wrapper">
            <div id="blogtitle"><a href="/">blog.dbrgn.ch</a></div>
            <ul id="mainnav">
                <li><a href="/">home</a></li>
                <li><a href="/archive/">archive</a></li>
                <li><a href="/tags/">tags</a></li>
                <li><a href="/blog/">about this blog</a></li>
                <li class="last"><a href="/about/">about me</a></li>
            </ul>

            <div class="clearboth"></div>

            <div id="content" class="hyphenate">
                
  <h1 class="title">dwm config - volume, battery notification, unread e-mail count &amp; more</h1>

  
    <div class="date">
      <p>written on Thursday, January 19, 2012</p>
    </div>
  

  <p>As many other <a class="reference external" href="http://dwm.suckless.org/">dwm</a> users do, I customized my
<cite>.xinitrc</cite> file and the dwm status bar in to display some useful information.
Here is my configuration:</p>
<div class="section" id="xinitrc">
<h2>.xinitrc</h2>
<p>This is what my .xinitrc looks like:</p>
<div class="highlight"><pre><span class="c"># set keyboard layout to Swiss German</span>
setxkbmap ch

<span class="c"># Load .Xresources file</span>
xrdb -merge ~/.Xresources

<span class="c"># Start xbindkeys</span>
xbindkeys &amp;

<span class="c"># Set some defaults</span>
<span class="nb">export </span><span class="nv">BROWSER</span><span class="o">=</span>chromium &amp;
<span class="nb">export </span><span class="nv">EDITOR</span><span class="o">=</span>vim &amp;
xdg-mime default evince.desktop application/pdf &amp;

<span class="c"># Loop</span>
<span class="k">while </span><span class="nb">true</span>
<span class="k">do</span>
    <span class="c"># Set root title</span>
    sh .xsetroot.sh

    <span class="c"># Check battery level</span>
    <span class="nv">BATT</span><span class="o">=</span><span class="k">$(</span> acpi -b | sed <span class="s1">&#39;s/.*[charging|unknown], \([0-9]*\)%.*/\1/gi&#39;</span> <span class="k">)</span>
    <span class="nv">STATUS</span><span class="o">=</span><span class="k">$(</span> acpi -b | sed <span class="s1">&#39;s/.*: \([a-zA-Z]*\),.*/\1/gi&#39;</span> <span class="k">)</span>
    <span class="k">if</span> <span class="o">([</span> <span class="nv">$BATT</span> -le 5 <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nv">$STATUS</span> <span class="o">==</span> <span class="s1">&#39;Discharging&#39;</span> <span class="o">])</span>; <span class="k">then</span>
        <span class="c"># Beep</span>
        <span class="nb">echo</span> -e <span class="s2">&quot;\007&quot;</span> &gt;/dev/tty10 <span class="o">&amp;&amp;</span> sleep 0.2
        <span class="nb">echo</span> -e <span class="s2">&quot;\007&quot;</span> &gt;/dev/tty10 <span class="o">&amp;&amp;</span> sleep 0.2
        <span class="nb">echo</span> -e <span class="s2">&quot;\007&quot;</span> &gt;/dev/tty10 <span class="o">&amp;&amp;</span> sleep 0.2
        <span class="c"># Blink</span>
        <span class="nb">echo</span> <span class="s1">&#39;on&#39;</span> &gt; /proc/acpi/ibm/light <span class="o">&amp;&amp;</span> sleep 1
        <span class="nb">echo</span> <span class="s1">&#39;off&#39;</span> &gt; /proc/acpi/ibm/light
    <span class="k">fi</span>

    <span class="c"># Update every 10s</span>
    sleep 10s
<span class="k">done</span> &amp;

<span class="c"># Set up rotated dual screen without touching my xorg.conf</span>
xrandr --output DVI-1 --auto --rotate left --pos 0x0 --output DVI-0 --auto --pos 1080x720 --rotate normal

<span class="c"># Read .xsessionrc</span>
sh ~/.xsessionrc &amp;

<span class="c"># Set wallpaper</span>
feh --bg-scale ~/.xwallpaper-dwm.png

<span class="c"># Set WM name (for Java apps)</span>
wmname LG3D

<span class="c"># Run dwm</span>
<span class="nb">exec </span>dwm
</pre></div>
</div>
<div class="section" id="xresources">
<h2>.Xresources</h2>
<p>In my <cite>.Xresources</cite>, I'm setting the UXTerm color to white on black, as well as
fixing a bug with the <tt class="docutils literal">Alt</tt> key in SSH sessions. The last line is to set the
window URGENT flag when the window uses the system bell.</p>
<div class="highlight"><pre>UXTerm*eightBitInput: <span class="nb">false</span>
UXTerm*metaSendsEscape: <span class="nb">true</span>
UXTerm*reverseVideo: <span class="nb">true</span>
UXTerm*bellIsUrgent: <span class="nb">true</span>
</pre></div>
</div>
<div class="section" id="xsetroot-sh">
<h2>.xsetroot.sh</h2>
<p>As you've seen in my <cite>.xinitrc</cite> file, I didn't want to keep my xsetroot commands
directly in that file. The main reason for this is that now I can update the
status information from an external script, e.g. when pushing some volume
buttons on my notebook.</p>
<div class="highlight"><pre><span class="nv">DATETIME</span><span class="o">=</span><span class="sb">`</span>date<span class="sb">`</span>
<span class="nv">UPTIME</span><span class="o">=</span><span class="sb">`</span>uptime | sed <span class="s1">&#39;s/.*up\s*//&#39;</span> | sed <span class="s1">&#39;s/,\s*[0-9]* user.*//&#39;</span> | sed <span class="s1">&#39;s/  / /g&#39;</span><span class="sb">`</span>
<span class="nv">VOLUME</span><span class="o">=</span><span class="k">$(</span> amixer sget Master | grep -e <span class="s1">&#39;Front Left:&#39;</span> | <span class="se">\</span>
    sed <span class="s1">&#39;s/[^\[]*\[\([0-9]\{1,3\}%\).*\(on\|off\).*/\2 \1/&#39;</span> | sed <span class="s1">&#39;s/off/M/&#39;</span> | sed <span class="s1">&#39;s/on //&#39;</span> <span class="k">)</span>
<span class="nv">UNREADMAIL</span><span class="o">=</span><span class="sb">`</span>cat .unreadmail<span class="sb">`</span>
<span class="nv">BATTERYSTATE</span><span class="o">=</span><span class="k">$(</span> acpi -b | awk <span class="s1">&#39;{ split($5,a,&quot;:&quot;); print substr($3,0,2), $4, &quot;[&quot;a[1]&quot;:&quot;a[2]&quot;]&quot; }&#39;</span> | tr -d <span class="s1">&#39;,&#39;</span> <span class="k">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="sb">`</span>date +%S<span class="sb">`</span> <span class="o">==</span> 30 -o <span class="sb">`</span>date +%S<span class="sb">`</span> <span class="o">==</span> 00 <span class="o">]</span>; <span class="k">then </span>python imap_check_unread.py &gt; .unreadmail; <span class="k">fi</span>
xsetroot -name <span class="s2">&quot;Unread ${UNREADMAIL} | ${VOLUME} | ${DATETIME} | Up ${UPTIME}h | ${BATTERYSTATE}&quot;</span>
</pre></div>
<p>The uptime value doesn't look perfect, there are bugs if the uptime is
&lt;1h. But that doesn't bug me :)</p>
<p>In summary, my status bar displays the following things:</p>
<ul class="simple">
<li>Unread e-mail count</li>
<li>Volume</li>
<li>Date and time</li>
<li>Uptime</li>
<li>Battery status</li>
</ul>
</div>
<div class="section" id="imap-check-unread-py">
<h2>imap_check_unread.py</h2>
<p>To check the unread mail count in my IMAP account, I created a little Python
script. But because I don't want to query the server every second, I'm caching
the value in a file and update it every 30 seconds. Create a cronjob or similar
to update the file.</p>
<div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">imaplib</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">imaplib</span><span class="o">.</span><span class="n">IMAP4_SSL</span><span class="p">(</span><span class="s">&#39;xxx.xxx.xxx.xxx&#39;</span><span class="p">,</span> <span class="s">&#39;993&#39;</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;UnSeen&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</pre></div>
</div>


  
      <a href="https://flattr.com/submit/auto?user_id=danilo&url=http://blog.dbrgn.ch/2012/1/19/dwm-config-volume-battery-notification-unread-e-mail-count-more/&title=dwm%20config%20-%20volume%2C%20battery%20notification%2C%20unread%20e-mail%20count%20%26%20more&description=My%20dwm%20configuration.&tags=dwm%2C%20sysadmin&category=text">
           <img class="flattrbutton" src="/static/img/flattr-badge-large.png" alt="Flattr this!" /> 
      </a>
  

  
    <div class="tags">
      <p>This entry was tagged
      
        <a href="/tags/dwm/">dwm</a> and 
        <a href="/tags/sysadmin/">sysadmin</a></p>
    </div>
  

  
    
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dbrgn'; // required: replace example with your forum shortname
    
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

  

            </div>
        </div>

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-1033934-12']);
          _gaq.push(['_trackPageview']);
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
        <script type="text/javascript" src="/static/hyphenator.js"></script>
        <script type="text/javascript">
            Hyphenator.config({
                donthyphenateclassname : 'docutils literal'
            });
            Hyphenator.run();
        </script>

    </body>
</html>
